<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Rust Wasm DOM Handling App</title>
    <script src="https://cdn.jsdelivr.net/npm/@tailwindcss/browser@4"></script>

</head>
<body class="mx-30 w-auto">
    <div class="text-4xl font-bold my-4">** RUST WASM DOM APP **</div>
    <div class="my-2">
        <span id="msgtype">*DEFAULT MESSAGE* : </span>
        <span class="border border-teal-600 rounded p-1" id="msg"></span>
    </div>
    <div class="my-2">
        Enter: message: <input id="messageid" class="p-1 border rounded-sm"  type="text" placeholder="message..." oninput="setInputVal(this.value)" />
    </div>
    <div class="my-2">
        <button class="border my-2 rounded-sm p-1 hover:bg-gray-200" onclick="defaultmessage()">Default message</button>
        <button class="border my-2 rounded-sm p-1 hover:bg-gray-200" onclick="custommessage()">Custom message</button>
    </div>
    
    <div class="flex gap-12">
        <div class="my-2">
            <div>Select Zone:</div>
            <select id="idselectzone" class="p-1 border rounded-sm" onchange="updateZoneTime()">
                <option value="">- Select -</option>
            </select>
        </div>
        <!-- clock -->
        <div>
            <div class="my-2 w-200 border border-teal-600 rounded-sm p-1">
                <span id="idzonetime" class="p-1 font-bold italic px-2 ring-2 ring-blue-500 rounded-sm">-- ztime here --</span>
            </div> 
            <div id="clock">
                <svg viewBox="-50 -50 100 100" width="500">
                    <circle id="face" r="49" fill="lightcyan" stroke="lightblue" />
                    <circle id="face-inner" r="9" fill="cornflowerblue" />
                    <line id="thr" x1="-4" x2="30" stroke="navy" stroke-linecap="round" transform="rotate(-150)" />
                    <line id="tmi" x1="-4" x2="40" stroke="navy" stroke-linecap="round" transform="rotate(-30)" />
                </svg>
            </div>
        </div>
    </div>


    <script type="module">
        import init, { 
            hello, set_message, set_zone_time, set_elem_value
        } from './pkg/rsdomlib.js';

        let inputval = '';

        const elemId = (id) => document.getElementById(id);

        window.setInputVal = function(val) {
            inputval = val;
        }

        window.defaultmessage = function() {
            elemId("msgtype").textContent = "*DEFAULT MESSAGE*";
            hello("msg");
        }
        window.custommessage = function() {
            elemId("msgtype").textContent = "*CUSTOM MESSAGE*";
            set_message("msg", (inputval || "nothing") + "...modified");
        }

        window.updateZoneTime = function() {
            let zoneselected = elemId('idselectzone').value;
            if (!zoneselected) {
                set_message("idzonetime", "Please select a timezone");
                return;
            }
            set_zone_time("idzonetime", zoneselected);
        }

        window.greeting = function(inputval) {
            set_message("msg", inputval);
        }

        window.addOption = function(selectId, optionValue) {
            let opt = document.createElement("option");
            opt.value = optionValue;
            opt.text = optionValue;
            elemId(selectId).appendChild(opt);
        }

        init().then(() => {
            if (Intl.supportedValuesOf) {
                const timezones = Intl.supportedValuesOf('timeZone');
                timezones.forEach(tz => {
                    addOption('idselectzone', tz);
                });
                elemId("idselectzone").setAttribute('size',25);
            } else {
                alert("err: supportedValuesOf");
            }
            hello("msg");
        });
    </script>
</body>
</html>
